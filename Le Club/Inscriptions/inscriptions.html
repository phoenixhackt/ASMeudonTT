<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Inscriptions</title>
    <link rel="stylesheet" href="inscriptions.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <?php
    use PHPMailer\PHPMailer\PHPMailer;
    use PHPMailer\PHPMailer\Exception;
    
    require 'vendor/autoload.php'; // Inclure le fichier d'autoloader de PHPMailer
    
    if(isset($_POST['submit'])) {
        // Récupérer les données du formulaire
        $nom = $_POST['nom'];
        $prenom = $_POST['prenom'];
        $sexe = $_POST['sexe'];
        $date_naissance = $_POST['date_naissance'];
        $nationalite = $_POST['nationalite'];
        $adresse = $_POST['adresse'];
        $code_postal = $_POST['code_postal'];
        $ville = $_POST['ville'];
        $tel_port = $_POST['tel_port'];
        $email = $_POST['email'];
    
        // Vérifier les champs obligatoires
        if($nom == "" || $prenom == "" || $sexe == "" || $date_naissance == "" || $nationalite == "" || $adresse == "" || $code_postal == "" || $ville == "" || $tel_port == "" || $email == "") {
            echo "Veuillez remplir tous les champs obligatoires.";
            exit();
        }
    
        // Envoyer l'email
        $mail = new PHPMailer(true);
        try {
            //Configurer le serveur SMTP
            $mail->isSMTP();                                            
            $mail->Host       = 'smtp.gmail.com';                     
            $mail->SMTPAuth   = true;                                   
            $mail->Username   = 'maxencepru@gmail.com';                     
            $mail->Password   = 'Jalm$16#2006';                               
            $mail->SMTPSecure = 'tls';         
            $mail->Port       = 587;                                    
    
            // Destinataire
            $mail->setFrom('votre_adresse_email@gmail.com', 'Votre nom');
            $mail->addAddress('maxencepru@gmail.com');    
    
            // Contenu de l'email
            $mail->isHTML(true);                                 
            $mail->Subject = 'Nouvelle inscription';
            $mail->Body    = "Nom: $nom \n Prénom: $prenom \n Sexe: $sexe \n Date de naissance: $date_naissance \n Nationalité: $nationalite \n Adresse: $adresse \n Code postal: $code_postal \n Ville: $ville \n Téléphone portable: $tel_port \n E-mail: $email";
    
            $mail->send();
            echo "Votre inscription a bien été enregistrée.";
        } catch (Exception $e) {
            echo "Une erreur est survenue lors de l'envoi de l'email : {$mail->ErrorInfo}";
        }
    }
    ?>    
    <form method="post">
        <label>Nom *</label>
        <input type="text" name="nom" required>
        <label>Prénom *</label>
        <input type="text" name="prenom" required>
        <label>Sexe *</label>
        <select name="sexe" required>
            <option value="">-- Sélectionnez --</option>
            <option value="M">Masculin</option>
            <option value="F">Féminin</option>
        </select>
        <label>Date de naissance *</label>
        <input type="date" name="date_naissance" required>
        <label>Nationalité *</label>
        <input type="text" name="nationalite" required>
        <label>Adresse *</label>
        <input type="text" name="adresse" required>
        <label>Code postal *</label>
        <input type="text" name="code_postal" required>
        <label>Ville *</label>
        <input type="text" name="ville" required>
        <label>Téléphone portable *</label>
        <input type="text" name="tel_port" required>
        <label>E-mail *</label>
        <input type="email" name="email" required>
        <input type="submit" name="submit" value="Envoyer">
      </form>
  </body>
</html>
